# Hướng dẫn chạy dự án bằng npm (local)

Tài liệu này hướng dẫn chạy dự án trên máy cá nhân bằng npm (không sử dụng Docker).

## 1) Chuẩn bị
- Node.js LTS (khuyến nghị v20)
- npm (đi kèm Node)
- MySQL 8.0 cài trên máy (service đang chạy)
  - Tạo user `root`/`1234` (hoặc dùng tài khoản của bạn)
  - Tạo database `drone_fastfood`

## 2) Cấu hình backend (.env)
- Tại thư mục `backend`, sao chép tệp `.env.example` thành `.env` rồi chỉnh thông số nếu cần.
- Ví dụ `.env` tối thiểu (theo mặc định file mẫu):
  ```env
  PORT=3000
  JWT_SECRET=changeme-in-dev
  DATABASE_URL=mysql://root:1234@localhost:3306/drone_fastfood
  PAYMENT_WEBHOOK_SECRET=dev-webhook-secret
  # Tuỳ chọn (routing):
  # OSRM_BASE_URL=https://router.project-osrm.org
  ```

## 3) Cài dependencies và khởi tạo CSDL
- Backend:
  ```cmd
  cd /d C:\CONGNNGHEPHANMEM\backend
  npm install
  # sinh Prisma Client (nếu cần)
  npm run prisma:generate
  # migrate schema (tạo bảng; lần đầu có thể yêu cầu tạo DB)
  npm run prisma:migrate
  # (khuyến nghị) seed dữ liệu mẫu
  npm run prisma:seed
  ```

- Frontend:
  ```cmd
  cd /d C:\CONGNNGHEPHANMEM\fedrone\fedrone
  npm install
  ```

## 4) Chạy chế độ phát triển (hot reload)
- Chạy backend dev (ts-node):
  ```cmd
  cd /d C:\CONGNNGHEPHANMEM\backend
  npm run dev
  # Server lắng nghe tại http://localhost:3000
  ```

- Chạy frontend dev (Vite):
  - Nếu backend chạy ở cổng 3000, cấu hình API base cho FE qua biến môi trường Vite (tuỳ chọn, nếu FE chưa tự trỏ đúng):
    ```cmd
    set VITE_API_BASE_URL=http://localhost:3000
    ```
  - Khởi chạy Vite:
    ```cmd
    cd /d C:\CONGNNGHEPHANMEM\fedrone\fedrone
    npm run dev
    # Mặc định Vite phục vụ ở http://localhost:5173
    ```

- Truy cập giao diện dev: http://localhost:5173

## 5) Chạy chế độ production (không Docker)
- Build frontend:
  ```cmd
  cd /d C:\CONGNNGHEPHANMEM\fedrone\fedrone
  npm run build
  ```
- Copy build frontend sang thư mục public của backend để server phục vụ tĩnh:
  - Tạo thư mục `backend\public` nếu chưa có.
  - Sao chép toàn bộ `fedrone\fedrone\dist` vào `backend\public` (có thể dùng File Explorer hoặc lệnh):
    ```cmd
    cd /d C:\CONGNNGHEPHANMEM\backend
    if not exist public mkdir public
    robocopy ..\fedrone\fedrone\dist public /E
    ```
- Build + start backend:
  ```cmd
  cd /d C:\CONGNNGHEPHANMEM\backend
  npm run build
  npm run start
  # Mặc định lắng nghe theo PORT trong .env (3000)
  ```
- Truy cập: http://localhost:3000

## 6) Tài khoản admin và dữ liệu mẫu
- Sau khi migrate + seed:
  - Nếu seed đã tạo dữ liệu mẫu (nhà hàng, món ăn), bạn sẽ thấy ngay dữ liệu.
  - Nếu seed không tạo admin, bạn có thể:
    1) Đăng ký tài khoản người dùng bình thường trên giao diện web.
    2) Nâng quyền trong MySQL:
       ```cmd
       mysql -uroot -p1234 -D drone_fastfood -e "UPDATE User SET role='ADMIN' WHERE email='YOUR_EMAIL@EXAMPLE.COM';"
       ```
  3) Đăng nhập trang Admin: http://localhost:5173/admin/login (dev) hoặc http://localhost:3000/admin/login (prod) và dùng các nút seed trong UI (nếu có) để thêm dữ liệu.

## 7) Lỗi thường gặp
- "@prisma/client did not initialize yet":
  - Chạy `npm run prisma:generate`, sau đó thử lại.
- Không kết nối được MySQL:
  - Kiểm tra `DATABASE_URL` đúng host/port/user/pass.
  - Kiểm tra MySQL service đang chạy, user có quyền tạo/migrate DB.
- Port xung đột:
  - Đổi `PORT` trong `backend/.env` (ví dụ 3002) và cập nhật `VITE_API_BASE_URL` tương ứng khi chạy FE dev.
- Seed lỗi vì thiếu quyền/DB chưa tồn tại:
  - Đảm bảo `npm run prisma:migrate` chạy OK trước.


